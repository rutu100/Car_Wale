{% extends 'base.html' %}
{% load crispy_forms_tags %}
{% load static %}

{% block title %}{{ car.name }} | Car Hub{% endblock %}

{% block content %}
<div class="container mt-5">

<!-- ================= MESSAGES ================= -->
{% if messages %}
{% for message in messages %}
<div class="alert alert-{{ message.tags }} text-center w-50 mx-auto">
    {{ message }}
</div>
{% endfor %}
{% endif %}

<!-- ================= CAR DETAILS CARD ================= -->
<div class="card shadow-lg border-0 mb-5">
<div class="row g-0 align-items-center">

<!-- Car Image -->
<div class="col-md-5 text-center p-4">
{% if car.image %}
<img src="{{ car.image.url }}" class="img-fluid rounded shadow-sm" alt="{{ car.name }}">
{% else %}
<p class="text-muted">No image available</p>
{% endif %}
</div>

<!-- Car Info -->
<div class="col-md-7">
<div class="card-body p-4">

<h2 class="fw-bold">{{ car.name }}</h2>

<span class="badge bg-primary me-2">{{ car.brand.name }}</span>
<span class="badge bg-success">Available</span>

<!-- Rating (UI only) -->
<div class="mt-2 text-warning">
<i class="bi bi-star-fill"></i>
<i class="bi bi-star-fill"></i>
<i class="bi bi-star-fill"></i>
<i class="bi bi-star-fill"></i>
<i class="bi bi-star-half"></i>
<small class="text-muted">(4.5/5)</small>
</div>

<p class="mt-3 text-muted">{{ car.description }}</p>

<!-- Price & Stock -->
<div class="row mt-4">
<div class="col-6">
<p class="mb-1"><strong>Price</strong></p>
<h4 class="text-success">â‚¹ {{ car.price }}</h4>
</div>
<div class="col-6">
<p class="mb-1"><strong>Stock</strong></p>
<h5>{{ car.quantity }}</h5>
</div>
</div>

<!-- Buy Button -->
{% if user.is_authenticated %}
{% if car.quantity > 0 %}
<form method="post" class="mt-4">
{% csrf_token %}
<button name="buy_now" class="btn btn-primary px-4">
<i class="bi bi-cart-check me-1"></i> Buy Now
</button>
</form>
{% else %}
<button class="btn btn-secondary mt-4" disabled>
Out of Stock
</button>
{% endif %}
{% else %}
<p class="mt-4">
<a href="{% url 'login' %}">Login</a> to buy this car
</p>
{% endif %}

<!-- Admin Controls -->
{% if user == car.author or user.is_superuser %}
<div class="mt-4 border-top pt-3">
<a href="{% url 'edit_car' car.id %}" class="btn btn-outline-warning btn-sm me-2">
<i class="bi bi-pencil"></i> Edit
</a>
<a href="{% url 'delete_car' car.id %}"
   class="btn btn-outline-danger btn-sm"
   onclick="return confirm('Are you sure you want to delete this car?')">
<i class="bi bi-trash"></i> Delete
</a>
</div>
{% endif %}

</div>
</div>
</div>
</div>

<!-- ================= SPECIFICATIONS ================= -->
<div class="card shadow-sm mb-4">
<div class="card-body">
<h5 class="fw-bold mb-3">Key Specifications</h5>

<div class="row text-center">
<div class="col-md-3">
<p class="mb-1 text-muted">Fuel Type</p>
<strong>Petrol</strong>
</div>
<div class="col-md-3">
<p class="mb-1 text-muted">Transmission</p>
<strong>Manual / Automatic</strong>
</div>
<div class="col-md-3">
<p class="mb-1 text-muted">Mileage</p>
<strong>20 km/l</strong>
</div>
<div class="col-md-3">
<p class="mb-1 text-muted">Seating</p>
<strong>5 Seater</strong>
</div>
</div>
</div>
</div>

<!-- ================= COMMENTS ================= -->
<div class="card shadow-sm mb-4">
<div class="card-body">
<h5 class="fw-bold mb-3">
Comments ({{ comments|length }})
</h5>

{% for comment in comments %}
<div class="border rounded p-3 mb-3">
<div class="d-flex justify-content-between">
<strong>{{ comment.name }}</strong>
<small class="text-muted">
{{ comment.created_on|date:"d M Y, H:i" }}
</small>
</div>
<p class="mb-0 mt-2">{{ comment.body }}</p>
</div>
{% empty %}
<p class="text-muted">No comments yet. Be the first!</p>
{% endfor %}
</div>
</div>

<!-- ================= ADD COMMENT ================= -->
<div class="card shadow-sm mb-5">
<div class="card-body">
<h5 class="fw-bold mb-3">Add a Comment</h5>

<form method="post">
{% csrf_token %}
{{ comment_form|crispy }}
<button name="comment" class="btn btn-warning mt-2">
<i class="bi bi-chat-dots"></i> Submit Comment
</button>
</form>
</div>
</div>

</div>
{% endblock %}
