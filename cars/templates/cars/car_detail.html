{% extends 'base.html' %}
{% load crispy_forms_tags %}
{% load static %}

{% block title %}{{ car.name }} | Car Hub{% endblock %}

{% block content %}
<div class="container mt-5">

{% if messages %}
{% for message in messages %}
<div class="alert alert-{{ message.tags }} text-center w-50 mx-auto">
    {{ message }}
</div>
{% endfor %}
{% endif %}

<div class="card shadow border-0 mb-4">
<div class="row g-0 align-items-center">

<div class="col-md-5 text-center p-4">
{% if car.image %}
<img src="{{ car.image.url }}" class="img-fluid rounded shadow-sm">
{% else %}
<p>No image available</p>
{% endif %}
</div>

<div class="col-md-7">
<div class="card-body p-4">
<h2>{{ car.name }}</h2>

<span class="badge bg-primary">{{ car.brand.name }}</span>

<p class="mt-3">{{ car.description }}</p>

<div class="row">
<div class="col-6">
<p><strong>Price:</strong></p>
<h4 class="text-success">â‚¹ {{ car.price }}</h4>
</div>
<div class="col-6">
<p><strong>Available:</strong></p>
<h5>{{ car.quantity }}</h5>
</div>
</div>

{% if user.is_authenticated %}
{% if car.quantity > 0 %}
<form method="post" class="mt-3">
{% csrf_token %}
<button name="buy_now" class="btn btn-primary">Buy Now</button>
</form>
{% else %}
<button class="btn btn-secondary mt-3" disabled>Out of Stock</button>
{% endif %}
{% else %}
<p class="mt-3"><a href="{% url 'login' %}">Login</a> to buy this car</p>
{% endif %}

</div>
</div>
</div>
</div>

<div class="card mb-4">
<div class="card-body">
<h5>Comments ({{ comments|length }})</h5>

{% for comment in comments %}
<div class="border rounded p-3 mb-2">
<strong>{{ comment.name }}</strong>
<small class="text-muted float-end">{{ comment.created_on }}</small>
<p>{{ comment.body }}</p>
</div>
{% empty %}
<p>No comments yet</p>
{% endfor %}
</div>
</div>

<div class="card mb-5">
<div class="card-body">
<h5>Add Comment</h5>
<form method="post">
{% csrf_token %}
{{ comment_form|crispy }}
<button name="comment" class="btn btn-warning mt-2">
Submit Comment
</button>
</form>
</div>
</div>

</div>
{% endblock %}
